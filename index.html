<div id="whatsapp-qr"
  style="
    width:300px;
    height:300px;
    border:1px solid #ccc;
    border-radius:12px;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#fff;
  ">
  <p>Waiting for QR...</p>
</div>

<script>
  // Auto-detect WS or WSS depending on protocol
  const protocol = location.protocol === "https:" ? "wss:" : "ws:";
  const ws = new WebSocket(`${protocol}//${location.host}`);

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      if (data.qr) {
        document.getElementById("whatsapp-qr").innerHTML =
          `<img src="${data.qr}" style="width:100%;height:100%;object-fit:contain;border-radius:12px;" />`;
      }
    } catch(err) {
      console.error("Invalid WS message:", err);
    }
  };

  ws.onopen = () => console.log("✅ WS connected");
  ws.onerror = err => console.error("❌ WS error", err);
  ws.onclose = () => console.log("⚠️ WS closed");
</script>
